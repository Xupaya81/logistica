{% extends "base.html" %}

{% block content %}

<!-- Barra superior del panel -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Panel Principal</h2>
    <span class="text-muted">Sistema de Gestión de Transporte</span>
</div>

<!-- Métricas rápidas -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted mb-1">Despachos</h6>
                    <h3 class="fw-bold">{{ despachos_count }}</h3>
                </div>
                <i class="bi bi-truck fs-1 text-primary"></i>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted mb-1">Rutas registradas</h6>
                    <h3 class="fw-bold">{{ rutas_count }}</h3>
                </div>
                <i class="bi bi-signpost-split fs-1 text-success"></i>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted mb-1">Clientes activos</h6>
                    <h3 class="fw-bold">{{ clientes_count }}</h3>
                </div>
                <i class="bi bi-people fs-1 text-warning"></i>
            </div>
        </div>
    </div>
</div>

<!-- Gráficos -->
<div class="row mb-4">
    <div class="col-md-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white fw-bold">Estado de Despachos</div>
            <div class="card-body">
                <canvas id="despachosChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white fw-bold">Flota de Transporte</div>
            <div class="card-body">
                <canvas id="transporteChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Menú principal -->
<div class="row">
    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="fw-bold"><i class="bi bi-truck me-2"></i>Despachos</h5>
                <p class="text-muted">Ver todos los despachos registrados.</p>
                <a href="/site/despachos" class="btn btn-dark w-100">Ir</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="fw-bold"><i class="bi bi-signpost-split me-2"></i>Rutas</h5>
                <p class="text-muted">Listado de rutas nacionales e internacionales.</p>
                <a href="/site/rutas" class="btn btn-dark w-100">Ver rutas</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="fw-bold"><i class="bi bi-people me-2"></i>Clientes</h5>
                <p class="text-muted">Central de información de clientes.</p>
                <a href="/site/clientes" class="btn btn-dark w-100">Clientes</a>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Datos para gráficos (JSON Script) -->
{{ despachos_labels|json_script:"despachos-labels-data" }}
{{ despachos_data|json_script:"despachos-data-data" }}
{{ transport_types|json_script:"transport-types-data" }}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener datos desde los scripts JSON
        const despachosLabels = JSON.parse(document.getElementById('despachos-labels-data').textContent);
        const despachosData = JSON.parse(document.getElementById('despachos-data-data').textContent);
        const transportTypes = JSON.parse(document.getElementById('transport-types-data').textContent);

        // Gráfico de Despachos
        const ctxDespachos = document.getElementById('despachosChart').getContext('2d');
        new Chart(ctxDespachos, {
            type: 'doughnut',
            data: {
                labels: despachosLabels,
                datasets: [{
                    data: despachosData,
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        // Gráfico de Transporte
        const ctxTransporte = document.getElementById('transporteChart').getContext('2d');
        new Chart(ctxTransporte, {
            type: 'bar',
            data: {
                labels: ['Vehículos', 'Aeronaves'],
                datasets: [{
                    label: 'Unidades Disponibles',
                    data: transportTypes,
                    backgroundColor: ['#4e73df', '#1cc88a'],
                    borderColor: ['#4e73df', '#1cc88a'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    });
</script>
{% endblock %}
